# Manual

## Loading the module

The module is loaded with `require 'luacsound'` as usual. This returns a
function that provides the functionality to generate a new Csound definition
file (`.csd) including a new score. By calling this function multiple times,
several scores can be generated "in parallel".

## Generating a new Csound definition file

As said above, call the function provided by the module:

```lua
local csound = require 'luacsound'
local csd = csound()
```

Of course, this can be accomplished in one line:

```lua
local csd = require 'luacsound'()
```

What you get is an object (called "the Csd-object" here) providing the
functionality to load instruments an outputting the score. Instruments are
loaded by the `instr` method and can be used to fill the score (see later), the
output is generated by the `output` method.

## Loading instruments

Instruments are loaded into the Csd-object by calling the `instr` method:

```lua
local sine = csd:instr( 'sine' )
```

Calling `instr` loads the definition of the instrument from the `.orc` file with
the given name, `sine.orc` in this example (`.orc` is the extension Csound
traditionally uses for instrument definitions). The method returns a function
that can be used to fill the score of the Csd-object with notes.

## Instrument files

Defining instruments is done one instrument per file, which is quite pratical
for purposes of re-use. Starting the instument block with `instr` and ending it
with `endin` is ommitted. Instead of writing

```
          instr 3                       ; p3=duration of note
k1        linen     p4, p6, p3, p7      ; p4=amp
a1        oscil     k1, p5, 1           ; p5=freq
          out       a1                  ; p6=attack time
          endin                         ; p7=release time
```

and documenting the parameters, named parameters are used. Instruments are
numbered automatically when loaded. The example above becomes

```
k1        linen     $amp, $attack, $dur, $release
a1        oscil     k1, $freq, 1
          out       a1
```

## Using instruments

Using loaded instruments is easy. Simply call the associated functions,
providing suitable parameters:

```lua
sine{ freq = 'f6', start = 0, dur = 1, vol = 2 }
sine{ freq = 'f5', start = 1, dur = 1, vol = 2 }
sine{ freq = 'f4', start = 0.5, dur = 1, vol = 2 }
```

The function is called with a single argument, a table containing the named
arguments.

The call to an instrument function returns the instrument function itself. Hence
intrument calls can be concatenated:

```lua
sine{ freq = 'f6', start = 0, dur = 1, vol = 2 }
    { freq = 'f5', start = 1, dur = 1, vol = 2 }
    { freq = 'f4', start = 0.5, dur = 1, vol = 2 }
```


### Required parameters

The generated score uses the syntax of Csound´s standard numeric score. The
required parameters of each intrument or note statement are the starting time
and the duration time. These are given by the `start` and the `dur` entries of
the table the instrument function is called with.

### Carry of function arguments

Function arguments are carried from call to call per instrument function to the
effect that you don’t have to repeat this arguments in each call. The following
would create an equivalent score to the example above:

```lua
sine{ freq = 'f6', start = 0, dur = 1, vol = 2 }
    { freq = 'f5', start = 1 }
    { freq = 'f4', start = 0.5 }
```

### Pitch

You can use numbers for frequency parameters, such as `freq = 880.2`. A
converter from note names to numeric frequencies is built in, using standard
twelve-tone equal temperament tuning. As shown above, the note `f5` converts to
the frequency of an *f* above the 440 Hz *a*, approximately 698.456 Hz. Sharp
and flat notes are specified using `#` or `b` as you might expect, for example
`f#5` or `gb5`.

## Generating the output

Output is generated as a string by the `output` method:

```lua
local output = csd:output()
```

You can feed that via standard output directly into the `csound` command, save
it to a file or do some further processing.
